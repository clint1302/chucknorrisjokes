<!DOCTYPE HTML>
<html>
    <head>
        <title>GetNorrised</title>
        
        <link rel="stylesheet" href="css/style.css" />
        <link href="https://fonts.googleapis.com/css?family=Slabo+27px" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">        
        <!--<link rel="shortcut icon" href="favicon.ico">-->
		<link rel="stylesheet" type="text/css" href="css/main.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
        <script src="script/modernizr.custom.63321.js"></script>
        
    </head>

<body>

    <!--top-->
    <div class="container-fluid top-bar-bg">
        <div class="row">
            <div class="col-md-6">
                <a href="#" style="text-decoration: none;"><div class="logo-item">Get<span>Norrised</span><img src="img/logo.png" draggable="false"/></div></a>
            </div>
            <div class="col-md-6 top-right-block">
                <button type="button" class="btn btn-yellow btn-lg" data-toggle="modal" data-target="#myModal"><i class="fas fa-star"></i></button>
                <button type="button" id="messageButton" class="btn btn-hidden btn-lg" data-toggle="modal" data-target="#messageModal">hidden</button>
            </div>
        </div>
    </div>
    <!--top-->

         <!-- Modals -->
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header modal-head-custom">
                        <h4>Favorite lists</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body modal-body-custom">
                        <div class="favorite-list-block">
                            <ul class="favorite-list" id="favo-list">
                            </ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="col-sm-6">
                            <span class="auto-add-favo">
                                <input type="checkbox" name="autofav" id="auto-fav" onclick="autoFetchCheck()"/>
                                <label for="autofav">Auto Add Jokes</label>
                            </span>
                        </div>
                        <div class="col-sm-6 mdl-footer-buttons">
                            <button type="button" class="btn btn-default" id="fetch-favo">Fetch all time favorites</button>
                            <button type="button" class="btn btn-default" id="clear-favo">Clear favorites</button>
                        <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal fade" id="messageModal" role="dialog">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header modal-head-custom">
                            <h4>Message</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>

                        <div class="modal-body modal-body-custom">
                           <p>Randomly adding jokes has been deactivated.</p>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        <!-- Modals -->


        <div id="caroslider" class="carousel slide" data-interval="false">

        <!-- Indicators -->
        <ul class="carousel-indicators">
            <li data-target="#caroslider" data-slide-to="0" class="active"></li>
            <li data-target="#caroslider" data-slide-to="1"></li>
        </ul>
        
        <!-- The slideshow -->
        <div class="carousel-inner">

            <div class="carousel-item">
                    <div class="car-slide">
                        <div class="sec-slide">
                            <span class="sec-text">
                                <div><h1>YOU'RE ABOUT TO GET</h1></div>
                                <div><h1><strong>NORRISED</strong></h1></div>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="carousel-item active">
                <div class="car-slide" id="jokes-list" style="background-color: #333;">
                        <h1> CHUCK NORRIS TRUE FACTS.</h1>
                        <section class="main-stackslider">
                                <ul id="st-stack" class="st-stack-raw">
                                    <li><div class="st-item"><img src="img/meme/1.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/2.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/3.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/4.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/5.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/6.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/7.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/8.jpg"/></div></li>
                                    <li><div class="st-item"><img src="img/meme/9.jpg"/></div></li>
                                    
                                </ul>
                        </section>
                </div>
                </div>

        </div>
        
        <!-- Left and right controls -->
        <a class="carousel-control-prev" href="#caroslider" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </a>
        <a class="carousel-control-next" href="#caroslider" data-slide="next">
            <span class="carousel-control-next-icon"></span>
        </a>
        </div>

        <div class="container main-block">
            <div class="row">
                <div class="col-md-12 jokes-buttons-block">
                        <span class="refreshbutton-block">
                        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="svg-filters">
                            <defs>
                                <filter id="filter-goo-1">
                                    <feGaussianBlur in="SourceGraphic" stdDeviation="7" result="blur" />
                                    <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo" />
                                    <feComposite in="SourceGraphic" in2="goo" />
                                </filter>
                            </defs>
                        </svg>
                        <button id="component-1" class="button button--1 get-data">
                            Refresh
                            <span class="button__container">
                                <span class="circle top-left"></span>
                                <span class="circle top-left"></span>
                                <span class="circle top-left"></span>
                                <span class="button__bg"></span>
                                <span class="circle bottom-right"></span>
                                <span class="circle bottom-right"></span>
                                <span class="circle bottom-right"></span>
                            </span>
                        </button>
                        
                    </span>
                </div>

                <div class="col-md-12 jokes-list-block">
                    <ul class="jokes-list">
                    </ul>
                </div>
            </div>
        </div>

        <!--footer-->
        <div class="container-fluid footer-block">
            <div class="row">
                <div class="col-md-12 footer-sec">
                    <a href="#">GETNORRISED</a>
                </div>
            </div>
        </div>
        <!--footer-->

        <script src="script/TweenMax.min.js"></script>
        <script src="script/main.js"></script>
        
        <script type="text/javascript">

            //load on start
            window.onload = function() {

                //call function
                getdata();

            };
            
            //declare var
            var FavoList = $(".favorite-list");
            var ulFavo = document.getElementById("favo-list");
            var timer ;

            // get favorites from local storage or empty array
            var favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            

            // Click event to add to favorite list
            document.querySelector('.jokes-list').addEventListener('click', function(e) {
            var id = e.target.id,
                item = e.target,
                index = favorites.indexOf(id);

            // return if target doesn't have an id (shouldn't happen)
            if (!id) return;
            
                //myFavoJokes = JSON.parse(localStorage.getItem("favorites"));
            
                // item is not favorite
                if (index == -1) {

                    favorites.push(id);
                    item.className = "fav";

                    //add to favorite list
                    FavoList.append("<li id='"+id+"'>"+id+"</li>");
              
                // item is already favorite
                } else {
                    favorites.splice(index, 1);
                    item.className = '';
                }

            // store array in local storage
            localStorage.setItem('favorites', JSON.stringify(favorites));
            });
            
            //refresh data
            $('.get-data').click(function () {

                //call function
                getdata();

            });


            //fetch favorites
            $('#fetch-favo').click(function () {

                //call function
                FetchAfavorites();

            });
            
            //remove all favorites
            $('#clear-favo').click(function () {

                //clear list items
                ulFavo.innerHTML = "";

                //clear favorites list
                window.localStorage.removeItem('favorites');

            });
            

            //function to create li
            const liMaker = (text) => {
                const li = document.createElement('li');
                li.textContent = text;
                FavoList.append(li);
            }

             //function to fetch all favorites
             function FetchAfavorites(){

                console.log("Restoring array data from localstorage");

                myFavoJokes = JSON.parse(localStorage.getItem("favorites"));

                //Check if data exists
                if(myFavoJokes != null){
                    
                    //clean favorite list
                    ulFavo.innerHTML = "";

                    myFavoJokes.forEach(item => {
                        liMaker(item);
                     });
                    
                }else{

                    //if no favorites have been found
                    $(".favorite-list").append("<li>No favorite list found. Get yourself some Norris facts!</li>");

                }


            }

            //function to get data from api
            function getdata(){
                var url = "http://api.icndb.com/jokes/random/10";

                $.getJSON(url,
                function (data) {

                    console.log(data);

                    //count Jokes
                    var count_jokes = data.value.length;
                    var stringifytxt = JSON.stringify(data);//make json file readable
                    
                    //check if there are jokes
                    if(count_jokes > 0){
                        
                        //change text
                        //$("#joke-count").text("("+count_jokes+")");

                        var result = "";
                        $.each(data.value,function(index, value)
                        {
                            result += "<li id='"+value.joke+"'>"+value.joke+"</li>"
                        });

                        $('.jokes-list').html(result);
                        
                    }
                    
                });
            }

            //function to get 1 random joke
            function getAutoJoke(state){

                if(state == 1){

                    var url = "http://api.icndb.com/jokes/random/1";

                    $.getJSON(url,
                    function (data) {

                        //console.log(data.value);

                        //count Jokes
                        var count_jokes = data.value.length;
                        var stringifytxt = JSON.stringify(data);//make json file readable

                        //check if there is a joke
                        if(count_jokes > 0){

                            var randomJoke = "";

                            $.each(data.value,function(index, value)
                            {
                                randomJoke = value.joke;
                                
                                console.log(randomJoke);
                            
                                favorites.push(randomJoke);

                                //add to favorite list
                                FavoList.append("<li id='"+randomJoke+"'>"+randomJoke+"</li>");

                            });
                            
                            // store array in local storage
                            localStorage.setItem('favorites', JSON.stringify(favorites));
                            
                        }
                        
                    });

                }else{

                    alert("Something went wrong!");

                }

            }


            //Checkbox automatic add favorite Joke
            function autoFetchCheck(){

                var state = 0;

                if(document.getElementById('auto-fav').checked){

                    state = 1;
                    
                    //clean favorite list
                    ulFavo.innerHTML = "";

                    //call fetch all jokes function
                    FetchAfavorites();

                    //activate timer
                    timer = setInterval(function(){

                        //call auto fetch function
                        getAutoJoke(state);

                    }, 5000);

                }else{

                    //clear timer
                    clearInterval(timer);

                }
            }

           
        </script>

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script type="text/javascript" src="script/jquery.stackslider.js"></script>
        <script type="text/javascript">
			
			$( function() {
				
				$( '#st-stack' ).stackslider();

			});

		</script>
</body>

</html>